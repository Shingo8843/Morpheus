"use strict";exports.id=569,exports.ids=[569],exports.modules={7571:(e,t,n)=>{function o(e,t){let n=0;for(let o=0;o<t;o++)n+=e[o]*e[o];return Math.sqrt(n)}function r(e,t,n,r=.8){const s=o(e,n),i=[];for(const[o,[c,a]]of Object.entries(t)){let t=0;for(let o=0;o<n;o++)t+=e[o]*a[o];const l=t/(s*c);l>=r&&i.push([o,l])}return i.sort(((e,t)=>t[1]-e[1]))}n.d(t,{M:()=>r,T:()=>o})},9197:(e,t,n)=>{n.r(t),n.d(t,{formatElapsedTime:()=>s,getDocumentIndexId:()=>i,getDocumentProperties:()=>r.OX,getInnerType:()=>h,getVectorSize:()=>p,isArrayType:()=>d,isGeoPointType:()=>u,isVectorType:()=>f,validateSchema:()=>c});var o=n(5815),r=n(8070);async function s(e){return{raw:Number(e),formatted:await(0,r.Ed)(e)}}async function i(e){if(e.id){if("string"!=typeof e.id)throw(0,o.T)("DOCUMENT_ID_MUST_BE_STRING",typeof e.id);return e.id}return await(0,r.EL)()}async function c(e,t){for(const[n,r]of Object.entries(t)){const t=e[n];if(void 0!==t&&("geopoint"!==r||"object"!=typeof t||"number"!=typeof t.lon||"number"!=typeof t.lat)&&("enum"!==r||"string"!=typeof t&&"number"!=typeof t))if("enum[]"===r&&Array.isArray(t)){const e=t.length;for(let o=0;o<e;o++)if("string"!=typeof t[o]&&"number"!=typeof t[o])return n+"."+o}else if(f(r)){const e=p(r);if(!Array.isArray(t)||t.length!==e)throw(0,o.T)("INVALID_INPUT_VECTOR",n,e,t.length)}else if(d(r)){if(!Array.isArray(t))return n;const e=h(r),o=t.length;for(let r=0;r<o;r++)if(typeof t[r]!==e)return n+"."+r}else if("object"!=typeof r){if(typeof t!==r)return n}else{if(!t||"object"!=typeof t)return n;const e=await c(t,r);if(e)return n+"."+e}}}const a={string:!1,number:!1,boolean:!1,enum:!1,geopoint:!1,"string[]":!0,"number[]":!0,"boolean[]":!0,"enum[]":!0},l={"string[]":"string","number[]":"number","boolean[]":"boolean","enum[]":"enum"};function u(e){return"geopoint"===e}function f(e){return"string"==typeof e&&/^vector\[\d+\]$/.test(e)}function d(e){return"string"==typeof e&&a[e]}function h(e){return l[e]}function p(e){const t=Number(e.slice(7,-1));switch(!0){case isNaN(t):throw(0,o.T)("INVALID_VECTOR_VALUE",e);case t<=0:throw(0,o.T)("INVALID_VECTOR_SIZE",e);default:return t}}},7220:(e,t,n)=>{n.d(t,{RI:()=>r,ZI:()=>i,et:()=>a,mX:()=>c,me:()=>o,rf:()=>s});const o=["tokenizer","index","documentsStore","sorter"],r=["validateSchema","getDocumentIndexId","getDocumentProperties","formatElapsedTime"];async function s(e,t,n,o){const r=e.length;for(let s=0;s<r;s++)await e[s](t,n,o)}async function i(e,t,n){const o=e.length;for(let r=0;r<o;r++)await e[r](t,n)}async function c(e,t,n,o,r){const s=e.length;for(let i=0;i<s;i++)await e[i](t,n,o,r)}async function a(e,t,n,o){const r=e.length;for(let s=0;s<r;s++)await e[s](t,n,o)}},3714:(e,t,n)=>{function o(){return{idToInternalId:new Map,internalIdToId:[],save:r,load:s}}function r(e){return{internalIdToId:e.internalIdToId}}function s(e,t){const{internalIdToId:n}=t;e.internalDocumentIDStore.idToInternalId.clear(),e.internalDocumentIDStore.internalIdToId=[];for(let t=0;t<n.length;t++)e.internalDocumentIDStore.idToInternalId.set(n[t],t+1),e.internalDocumentIDStore.internalIdToId.push(n[t])}function i(e,t){if("string"==typeof t){const n=e.idToInternalId.get(t);if(n)return n;const o=e.idToInternalId.size+1;return e.idToInternalId.set(t,o),e.internalIdToId.push(t),o}return t>e.internalIdToId.length?i(e,t.toString()):t}function c(e,t){if(e.internalIdToId.length<t)throw new Error(`Invalid internalId ${t}`);return e.internalIdToId[t-1]}n.d(t,{HM:()=>i,K7:()=>c,Lo:()=>o})},1569:(e,t,n)=>{n.r(t),n.d(t,{create:()=>Ge});var o=n(9197),r=n(8070),s=n(3714);async function i(e,t){return{sharedInternalDocumentStore:t,docs:{},count:0}}async function c(e,t){const n=(0,s.HM)(e.sharedInternalDocumentStore,t);return e.docs[n]}async function a(e,t){const n=Array.from({length:t.length});for(let o=0;o<t.length;o++){const r=(0,s.HM)(e.sharedInternalDocumentStore,t[o]);n[o]=e.docs[r]}return n}async function l(e){return e.docs}async function u(e,t,n){const o=(0,s.HM)(e.sharedInternalDocumentStore,t);return void 0===e.docs[o]&&(e.docs[o]=n,e.count++,!0)}async function f(e,t){const n=(0,s.HM)(e.sharedInternalDocumentStore,t);return void 0!==e.docs[n]&&(delete e.docs[n],e.count--,!0)}async function d(e){return e.count}async function h(e,t){const n=t;return{docs:n.docs,count:n.count,sharedInternalDocumentStore:e}}async function p(e){return{docs:e.docs,count:e.count}}var g=n(5815);const m=["beforeInsert","afterInsert","beforeRemove","afterRemove","beforeUpdate","afterUpdate","beforeSearch","afterSearch","beforeInsertMultiple","afterInsertMultiple","beforeRemoveMultiple","afterRemoveMultiple","beforeUpdateMultiple","afterUpdateMultiple","beforeLoad","afterLoad"];async function y(e,t){var n;const o=[],r=null===(n=e.plugins)||void 0===n?void 0:n.length;if(!r)return o;for(let n=0;n<r;n++)try{const r=await e.plugins[n];"function"==typeof r[t]&&o.push(r[t])}catch(e){throw console.error("Caught error in getAllPluginsByHook:",e),(0,g.T)("PLUGIN_CRASHED")}return o}var b=n(7220);function T(e){const t=e.r;return e.r=t.l,t.l=e,e.h=Math.max(k(e.l),k(e.r))+1,t.h=Math.max(k(t.l),k(t.r))+1,t}function I(e){const t=e.l;return e.l=t.r,t.r=e,e.h=Math.max(k(e.l),k(e.r))+1,t.h=Math.max(k(t.l),k(t.r))+1,t}function v(e,t,n){const o=[];return function e(s){null!==s&&(t<s.k&&e(s.l),s.k>=t&&s.k<=n&&(0,r.hT)(o,s.v),n>s.k&&e(s.r))}(e.root),o}function w(e,t,n=!1){const o=[];return function e(s){null!==s&&(n&&s.k>=t&&(0,r.hT)(o,s.v),!n&&s.k>t&&(0,r.hT)(o,s.v),e(s.l),e(s.r))}(e.root),o}function D(e,t,n=!1){const o=[];return function e(s){null!==s&&(n&&s.k<=t&&(0,r.hT)(o,s.v),!n&&s.k<t&&(0,r.hT)(o,s.v),e(s.l),e(s.r))}(e.root),o}function S(e,t){for(;null!==e;)if(t<e.k)e=e.l;else{if(!(t>e.k))return e;e=e.r}return null}function k(e){return null!==e?e.h:-1}function P(e,t){const n=S(e.root,t);return null===n?null:n.v}function M(e,t){const n=Object.keys(t);if(1!==n.length)throw new Error("Invalid operation");const o=n[0];switch(o){case"eq":{const n=t[o];return e.numberToDocumentId.get(n)??[]}case"in":{const n=t[o],s=[];for(const t of n){const n=e.numberToDocumentId.get(t);null!=n&&(0,r.hT)(s,n)}return s}case"nin":{const n=t[o],s=[],i=e.numberToDocumentId.keys();for(const t of i){if(n.includes(t))continue;const o=e.numberToDocumentId.get(t);null!=o&&(0,r.hT)(s,o)}return s}}throw new Error("Invalid operation")}function O(e,t){const n=Object.keys(t);if(1!==n.length)throw new Error("Invalid operation");const o=n[0];if("containsAll"===o){const n=t[o].map((t=>e.numberToDocumentId.get(t)??[]));return(0,r.wf)(n)}throw new Error("Invalid operation")}var x=n(5795);class A{constructor(e,t,n){this.k=e,this.s=t,this.e=n}c={};d=[];w="";toJSON(){return{w:this.w,s:this.s,c:this.c,d:this.d,e:this.e}}}function R(e,t){e.w=t.w+e.s}function E(e,t){e.d.push(t)}function _(e,t){const n=e.d.indexOf(t);return-1!==n&&(e.d.splice(n,1),!0)}function L(e,t,n,o,s){if(e.e){const{w:i,d:c}=e;if(o&&i!==n)return{};if(null==(0,r.eg)(t,i)&&(s?Math.abs(n.length-i.length)<=s&&(0,x.j9)(n,i,s).isBounded&&(t[i]=[]):t[i]=[]),null!=(0,r.eg)(t,i)&&c.length>0){const e=new Set(t[i]),n=c.length;for(let t=0;t<n;t++)e.add(c[t]);t[i]=Array.from(e)}}for(const r of Object.keys(e.c))L(e.c[r],t,n,o,s);return t}function N(e,t){let n="";const o=Math.min(e.length,t.length);for(let r=0;r<o;r++){if(e[r]!==t[r])return n;n+=e[r]}return n}function z(e=!1,t="",n=""){return new A(n,t,e)}function C(e,t,n){const o=t.length;for(let r=0;r<o;r++){const o=t[r],s=t.substring(r),i=e.c[o];if(!i){const t=z(!0,s,o);return E(t,n),e.c[o]=t,void R(t,e)}{const c=i.s,a=c.length,l=N(c,s),u=l.length;if(c===s)return E(i,n),void(i.e=!0);const f=c[u];if(u<a&&u===s.length){const t=z(!0,s,o);t.c[f]=i;const r=t.c[f];return r.s=c.substring(u),r.k=f,e.c[o]=t,R(t,e),R(r,t),void E(t,n)}if(u<a&&u<s.length){const a=z(!1,l,o);a.c[f]=i,e.c[o]=a;const d=a.c[f];d.s=c.substring(u),d.k=f;const h=s[u],p=z(!0,t.substring(r+u),h);return E(p,n),a.c[h]=p,R(a,e),R(p,a),void R(d,a)}r+=a-1,e=i}}}function U(e,t,n,o,s,i){if(!(o<0))if(e.w.startsWith(t))L(e,i,t,!1,0);else{if(e.e){const{w:n,d:o}=e;if(n&&((0,x.j9)(t,n,s).isBounded&&(i[n]=[]),null!=(0,r.eg)(i,n)&&o.length>0)){const e=new Set(i[n]),t=o.length;for(let n=0;n<t;n++)e.add(o[n]);i[n]=Array.from(e)}}if(!(n>=t.length)){t[n]in e.c&&U(e.c[t[n]],t,n+1,o,s,i),U(e,t,n+1,o-1,s,i);for(const r in e.c)U(e.c[r],t,n,o-1,s,i);for(const r in e.c)r!==t[n]&&U(e.c[r],t,n+1,o-1,s,i)}}}function W(e,{term:t,exact:n,tolerance:o}){if(o&&!n){const n={};return U(e,t,0,(o=o||0)||0,o,n),n}{const r=t.length;for(let n=0;n<r;n++){const r=t[n];if(!(r in e.c))return{};{const s=e.c[r],i=s.s,c=t.substring(n),a=N(i,c).length;if(a!==i.length&&a!==c.length){if(o)break;return{}}n+=s.s.length-1,e=s}}const s={};return L(e,s,t,n,o),s}}function $(e,t,n,o=!0){if(!t)return!0;const r=t.length;for(let s=0;s<r;s++){const r=t[s];if(!(r in e.c))return!1;{const i=e.c[r];s+=i.s.length-1,e=i,o&&e.w!==t||_(e,n)}}return!0}const j=2,F=6371e3;function B(e,t,n,o=!0,r="asc",s=!1){const i=s?G:q,c=[{node:e,depth:0}],a=[];for(;c.length>0;){const{node:e,depth:r}=c.pop();if(null===e)continue;const s=i(t,e.point);(o?s<=n:s>n)&&a.push({point:e.point,docIDs:e.docIDs??[]}),null!=e.left&&c.push({node:e.left,depth:r+1}),null!=e.right&&c.push({node:e.right,depth:r+1})}return r&&a.sort(((e,n)=>{const o=i(t,e.point),s=i(t,n.point);return"asc"===r.toLowerCase()?o-s:s-o})),a}function V(e,t,n=!0,o=null,r=!1){const s=[{node:e,depth:0}],i=[];for(;s.length>0;){const e=s.pop();if(null==e||null==e.node)continue;const{node:o,depth:r}=e,c=r+1;null!=o.left&&s.push({node:o.left,depth:c}),null!=o.right&&s.push({node:o.right,depth:c});const a=H(t,o.point);a&&n?i.push({point:o.point,docIDs:o.docIDs??[]}):a||n||i.push({point:o.point,docIDs:o.docIDs??[]})}const c=function(e){let t=0,n=0,o=0;const r=e.length;for(let s=0,i=r-1;s<r;i=s++){const r=e[s].lon,c=e[s].lat,a=e[i].lon,l=e[i].lat,u=r*l-a*c;t+=u,n+=(r+a)*u,o+=(c+l)*u}t/=2;const s=6*t;return n/=s,o/=s,{lon:n,lat:o}}(t);if(o){const e=r?G:q;i.sort(((t,n)=>{const r=e(c,t.point),s=e(c,n.point);return"asc"===o.toLowerCase()?r-s:s-r}))}return i}function H(e,t){let n=!1;const o=t.lon,r=t.lat,s=e.length;for(let t=0,i=s-1;t<s;i=t++){const s=e[t].lon,c=e[t].lat,a=e[i].lon,l=e[i].lat;c>r!=l>r&&o<(a-s)*(r-c)/(l-c)+s&&(n=!n)}return n}function q(e,t){const n=Math.PI/180,o=e.lat*n,r=t.lat*n,s=(t.lat-e.lat)*n,i=(t.lon-e.lon)*n,c=Math.sin(s/2)*Math.sin(s/2)+Math.cos(o)*Math.cos(r)*Math.sin(i/2)*Math.sin(i/2),a=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));return F*a}function G(e,t){const n=6378137,o=1/298.257223563,r=(1-o)*n,s=Math.PI/180,i=e.lat*s,c=t.lat*s,a=(t.lon-e.lon)*s,l=Math.atan((1-o)*Math.tan(i)),u=Math.atan((1-o)*Math.tan(c)),f=Math.sin(l),d=Math.cos(l),h=Math.sin(u),p=Math.cos(u);let g,m,y,b,T,I,v=a,w=1e3;do{const e=Math.sin(v),t=Math.cos(v);b=Math.sqrt(p*e*(p*e)+(d*h-f*p*t)*(d*h-f*p*t)),T=f*h+d*p*t,I=Math.atan2(b,T),m=d*p*e/b,y=1-m*m;const n=T-2*f*h/y,r=o/16*y*(4+o*(4-3*y));g=v,v=a+(1-r)*o*m*(I+r*b*(n+r*T*(2*n*n-1)))}while(Math.abs(v-g)>1e-12&&--w>0);const D=y*(n*n-r*r)/(r*r),S=D/1024*(256+D*(D*(74-47*D)-128));return r*(1+D/16384*(4096+D*(D*(320-175*D)-768)))*(I-S*b*(T-2*f*h/y+S/4*(T*(2*b*b-1)-S/6*I*(4*b*b-3)*(4*I*I-3))))}var Y=n(5029),K=n(7571);async function X(e,t,n,o,r){const i=(0,s.HM)(e.sharedInternalDocumentStore,n);e.avgFieldLength[t]=((e.avgFieldLength[t]??0)*(r-1)+o.length)/r,e.fieldLengths[t][i]=o.length,e.frequencies[t][i]={}}async function Z(e,t,n,o,r){let i=0;for(const e of o)e===r&&i++;const c=(0,s.HM)(e.sharedInternalDocumentStore,n),a=i/o.length;e.frequencies[t][c][r]=a,r in e.tokenOccurrences[t]||(e.tokenOccurrences[t][r]=0),e.tokenOccurrences[t][r]=(e.tokenOccurrences[t][r]??0)+1}async function J(e,t,n,o){const r=(0,s.HM)(e.sharedInternalDocumentStore,n);e.avgFieldLength[t]=(e.avgFieldLength[t]*o-e.fieldLengths[t][r])/(o-1),e.fieldLengths[t][r]=void 0,e.frequencies[t][r]=void 0}async function Q(e,t,n){e.tokenOccurrences[t][n]--}async function ee(e,t,n,o,r){const i=Array.from(r),c=t.avgFieldLength[n],a=t.fieldLengths[n],l=t.tokenOccurrences[n],u=t.frequencies[n],f="number"==typeof l[o]?l[o]??0:0,d=[],h=i.length;for(let n=0;n<h;n++){var p;const r=(0,s.HM)(t.sharedInternalDocumentStore,i[n]),l=(null==u||null===(p=u[r])||void 0===p?void 0:p[o])??0,h=(0,Y.D)(l,f,e.docsCount,a[r],c,e.params.relevance);d.push([r,h])}return d}async function te(e,t,n,r,s=""){r||(r={sharedInternalDocumentStore:t,indexes:{},vectorIndexes:{},searchableProperties:[],searchablePropertiesWithTypes:{},frequencies:{},tokenOccurrences:{},avgFieldLength:{},fieldLengths:{}});for(const[c,a]of Object.entries(n)){const n=`${s}${s?".":""}${c}`;if("object"!=typeof a||Array.isArray(a))if((0,o.isVectorType)(a))r.searchableProperties.push(n),r.searchablePropertiesWithTypes[n]=a,r.vectorIndexes[n]={size:(0,o.getVectorSize)(a),vectors:{}};else{const e=/\[/.test(a);switch(a){case"boolean":case"boolean[]":r.indexes[n]={type:"Bool",node:{true:[],false:[]},isArray:e};break;case"number":case"number[]":r.indexes[n]={type:"AVL",node:(0,i=[],{root:{k:0,v:i,l:null,r:null,h:0}}),isArray:e};break;case"string":case"string[]":r.indexes[n]={type:"Radix",node:z(),isArray:e},r.avgFieldLength[n]=0,r.frequencies[n]={},r.tokenOccurrences[n]={},r.fieldLengths[n]={};break;case"enum":case"enum[]":r.indexes[n]={type:"Flat",node:{numberToDocumentId:new Map},isArray:e};break;case"geopoint":r.indexes[n]={type:"BKD",node:{root:null},isArray:e};break;default:throw(0,g.T)("INVALID_SCHEMA_TYPE",Array.isArray(a)?"array":a,n)}r.searchableProperties.push(n),r.searchablePropertiesWithTypes[n]=a}else te(e,t,a,r,n)}var i;return r}async function ne(e,t,n,o,r,i,c,a,l){const u=(0,s.HM)(t.sharedInternalDocumentStore,o),{type:f,node:d}=t.indexes[n];switch(f){case"Bool":d[r?"true":"false"].push(u);break;case"AVL":p=r,g=[u],(h=d).root=function e(t,n,o){if(null===t)return{k:n,v:o,l:null,r:null,h:0};if(n<t.k)t.l=e(t.l,n,o);else{if(!(n>t.k)){for(const e of o)t.v.push(e);return t}t.r=e(t.r,n,o)}t.h=1+Math.max(k(t.l),k(t.r));const r=k(t.l)-k(t.r);return r>1&&n<t.l.k?I(t):r<-1&&n>t.r.k?T(t):r>1&&n>t.l.k?(t.l=T(t.l),I(t)):r<-1&&n<t.r.k?(t.r=I(t.r),T(t)):t}(h.root,p,g);break;case"Radix":{const o=await a.tokenize(r,c,n);await e.insertDocumentScoreParameters(t,n,u,o,l);for(const r of o)await e.insertTokenScoreParameters(t,n,u,o,r),C(d,r,u);break}case"Flat":!function(e,t,n){e.numberToDocumentId.has(t)?e.numberToDocumentId.get(t).push(n):e.numberToDocumentId.set(t,[n])}(d,r,u);break;case"BKD":!function(e,t,n){const o={point:t,docIDs:n};if(null==e.root)return void(e.root=o);let r=e.root,s=0;for(;null!==r;){if(r.point.lon===t.lon&&r.point.lat===t.lat){const e=r.docIDs??[];return void(r.docIDs=Array.from(new Set([...e,...n||[]])))}if(0==s%j)if(t.lon<r.point.lon){if(null==r.left)return void(r.left=o);r=r.left}else{if(null==r.right)return void(r.right=o);r=r.right}else if(t.lat<r.point.lat){if(null==r.left)return void(r.left=o);r=r.left}else{if(null==r.right)return void(r.right=o);r=r.right}s++}}(d,r,[u])}var h,p,g}async function oe(e,t,n,r,s,i,c,a,l){if((0,o.isVectorType)(i))return function(e,t,n,o){n instanceof Float32Array||(n=new Float32Array(n));const r=e.vectorIndexes[t].size,s=(0,K.T)(n,r);e.vectorIndexes[t].vectors[o]=[s,n]}(t,n,s,r);if(!(0,o.isArrayType)(i))return ne(e,t,n,r,s,0,c,a,l);(0,o.getInnerType)(i);const u=s,f=u.length;for(let o=0;o<f;o++)await ne(e,t,n,r,u[o],0,c,a,l)}async function re(e,t,n,r,i,c,a,l,u){const f=(0,s.HM)(t.sharedInternalDocumentStore,r);if((0,o.isVectorType)(c))return delete t.vectorIndexes[n].vectors[r],!0;const{type:d,node:h}=t.indexes[n];switch(d){case"AVL":return function(e,t,n){const o=S(e.root,n);o&&(1!==o.v.length?o.v.splice(o.v.indexOf(t),1):function(e,t){if(null===e||null===e.root)return;let n=e.root,o=null;for(;null!=n&&n.k!==t;)o=n,n=t<n.k?n.l:n.r;null!==n&&(()=>{if(null===n.l&&null===n.r)null===o?e.root=null:o.l===n?o.l=null:o.r=null;else if(null!=n.l&&null!=n.r){let e=n.r,t=n;for(;null!=e.l;)t=e,e=e.l;n.k=e.k,t===n?t.r=e.r:t.l=e.r}else{const t=null!=n.l?n.l:n.r;null===o?e.root=t:o.l===n?o.l=t:o.r=t}})()}(e,n))}(h,f,i),!0;case"Bool":{const e=h[i?"true":"false"].indexOf(f);return h[i?"true":"false"].splice(e,1),!0}case"Radix":{const o=await l.tokenize(i,a,n);await e.removeDocumentScoreParameters(t,n,r,u);for(const r of o)await e.removeTokenScoreParameters(t,n,r),$(h,r,f);return!0}case"Flat":return function(e,t,n){var o,r;null==e||e.numberToDocumentId.set(n,(null===(o=null==e?void 0:e.numberToDocumentId.get(n))||void 0===o?void 0:o.filter((e=>e!==t)))??[]),0===(null===(r=null==e?void 0:e.numberToDocumentId.get(n))||void 0===r?void 0:r.length)&&(null==e||e.numberToDocumentId.delete(n))}(h,f,i),!0;case"BKD":return function(e,t,n){let o=e.root,r=0,s=null,i=null;for(;null!==o;){if((null==o?void 0:o.point.lon)===t.lon&&o.point.lat===t.lat){var c;const t=null===(c=o.docIDs)||void 0===c?void 0:c.indexOf(n);var a;if(void 0!==t&&t>-1)return null===(a=o.docIDs)||void 0===a||a.splice(t,1),void(null!=o.docIDs&&0!==o.docIDs.length||(null!=s?"left"===i?s.left=null!==o.left?o.left:o.right:"right"===i&&(s.right=null!==o.right?o.right:o.left):e.root=null!==o.left?o.left:o.right))}s=o,0==r%j?t.lon<o.point.lon?(o=null==o?void 0:o.left,i="left"):(o=null==o?void 0:o.right,i="right"):t.lat<o.point.lat?(o=null==o?void 0:o.left,i="left"):(o=null==o?void 0:o.right,i="right"),r++}}(h,i,f),!1}}async function se(e,t,n,r,s,i,c,a,l){if(!(0,o.isArrayType)(i))return re(e,t,n,r,s,i,c,a,l);const u=(0,o.getInnerType)(i),f=s,d=f.length;for(let o=0;o<d;o++)await re(e,t,n,r,f[o],u,c,a,l);return!0}async function ie(e,t,n,o){if(!(n in t.tokenOccurrences))return[];const{node:s,type:i}=t.indexes[n];if("Radix"!==i)throw(0,g.T)("WRONG_SEARCH_PROPERTY_TYPE",n);const{exact:c,tolerance:a}=e.params,l=W(s,{term:o,exact:c,tolerance:a}),u=new Set;for(const e in l)if((0,r.eg)(l,e))for(const t of l[e])u.add(t);return e.index.calculateResultScores(e,t,n,o,Array.from(u))}async function ce(e,t,n){const o=Object.keys(n),s=o.reduce(((e,t)=>({[t]:[],...e})),{});for(const i of o){const o=n[i];if(void 0===t.indexes[i])throw(0,g.T)("UNKNOWN_FILTER_PROPERTY",i);const{node:c,type:a,isArray:l}=t.indexes[i];if("Bool"===a){const e=c[o.toString()];(0,r.hT)(s[i],e);continue}if("BKD"===a){let e;if("radius"in o)e="radius";else{if(!("polygon"in o))throw new Error(`Invalid operation ${o}`);e="polygon"}if("radius"===e){const{value:t,coordinates:n,unit:a="m",inside:l=!0,highPrecision:u=!1}=o[e],f=(0,r.Mo)(t,a),d=B(c.root,n,f,l,void 0,u);(0,r.hT)(s[i],d.map((({docIDs:e})=>e)).flat())}else{const{coordinates:t,inside:n=!0,highPrecision:a=!1}=o[e],l=V(c.root,t,n,void 0,a);(0,r.hT)(s[i],l.map((({docIDs:e})=>e)).flat())}continue}if("Radix"===a&&("string"==typeof o||Array.isArray(o))){for(const t of[o].flat()){const n=await e.tokenizer.tokenize(t,e.language,i);for(const e of n){const t=W(c,{term:e,exact:!0});(0,r.hT)(s[i],Object.values(t).flat())}}continue}const u=Object.keys(o);if(u.length>1)throw(0,g.T)("INVALID_FILTER_OPERATION",u.length);if("Flat"!==a){if("AVL"===a){const e=u[0],t=o[e];let n=[];switch(e){case"gt":n=w(c,t,!1);break;case"gte":n=w(c,t,!0);break;case"lt":n=D(c,t,!1);break;case"lte":n=D(c,t,!0);break;case"eq":n=P(c,t)??[];break;case"between":{const[e,o]=t;n=v(c,e,o);break}}(0,r.hT)(s[i],n)}}else l?(0,r.hT)(s[i],O(c,o)):(0,r.hT)(s[i],M(c,o))}return(0,r.wf)(Object.values(s))}async function ae(e){return e.searchableProperties}async function le(e){return e.searchablePropertiesWithTypes}function ue(e){const t=z(e.e,e.s,e.k);t.d=e.d,t.w=e.w;for(const n of Object.keys(e.c))t.c[n]=ue(e.c[n]);return t}function fe(e){return{numberToDocumentId:new Map(e)}}function de(e){return Array.from(e.numberToDocumentId.entries())}async function he(e,t){const{indexes:n,vectorIndexes:o,searchableProperties:r,searchablePropertiesWithTypes:s,frequencies:i,tokenOccurrences:c,avgFieldLength:a,fieldLengths:l}=t,u={},f={};for(const e of Object.keys(n)){const{node:t,type:o,isArray:r}=n[e];switch(o){case"Radix":u[e]={type:"Radix",node:ue(t),isArray:r};break;case"Flat":u[e]={type:"Flat",node:fe(t),isArray:r};break;default:u[e]=n[e]}}for(const e of Object.keys(o)){const t=o[e].vectors;for(const e in t)t[e]=[t[e][0],new Float32Array(t[e][1])];f[e]={size:o[e].size,vectors:t}}return{sharedInternalDocumentStore:e,indexes:u,vectorIndexes:f,searchableProperties:r,searchablePropertiesWithTypes:s,frequencies:i,tokenOccurrences:c,avgFieldLength:a,fieldLengths:l}}async function pe(e){const{indexes:t,vectorIndexes:n,searchableProperties:o,searchablePropertiesWithTypes:r,frequencies:s,tokenOccurrences:i,avgFieldLength:c,fieldLengths:a}=e,l={};for(const e of Object.keys(n)){const t=n[e].vectors;for(const e in t)t[e]=[t[e][0],Array.from(t[e][1])];l[e]={size:n[e].size,vectors:t}}const u={};for(const e of Object.keys(t)){const{type:n,node:o,isArray:r}=t[e];u[e]="Flat"===n?{type:"Flat",node:de(o),isArray:r}:t[e]}return{indexes:u,vectorIndexes:l,searchableProperties:o,searchablePropertiesWithTypes:r,frequencies:s,tokenOccurrences:i,avgFieldLength:c,fieldLengths:a}}function ge(e,t,n,s,i){const c={language:e.tokenizer.language,sharedInternalDocumentStore:t,enabled:!0,isSorted:!0,sortableProperties:[],sortablePropertiesWithTypes:{},sorts:{}};for(const[a,l]of Object.entries(n)){const n=`${i}${i?".":""}${a}`;if(!s.includes(n))if("object"!=typeof l||Array.isArray(l)){if(!(0,o.isVectorType)(l))switch(l){case"boolean":case"number":case"string":c.sortableProperties.push(n),c.sortablePropertiesWithTypes[n]=l,c.sorts[n]={docs:new Map,orderedDocsToRemove:new Map,orderedDocs:[],type:l};break;case"geopoint":case"enum":case"enum[]":case"boolean[]":case"number[]":case"string[]":continue;default:throw(0,g.T)("INVALID_SORT_SCHEMA_TYPE",Array.isArray(l)?"array":l,n)}}else{const o=ge(e,t,l,s,n);(0,r.hT)(c.sortableProperties,o.sortableProperties),c.sorts={...c.sorts,...o.sorts},c.sortablePropertiesWithTypes={...c.sortablePropertiesWithTypes,...o.sortablePropertiesWithTypes}}}return c}async function me(e,t,n,o){return!1!==(null==o?void 0:o.enabled)?ge(e,t,n,(o||{}).unsortableProperties||[],""):{disabled:!0}}async function ye(e,t,n,o){if(!e.enabled)return;e.isSorted=!1;const r=(0,s.HM)(e.sharedInternalDocumentStore,n),i=e.sorts[t];i.docs.set(r,i.orderedDocs.length),i.orderedDocs.push([r,o])}function be(e){if(e.isSorted)return;if(!e.enabled)return;const t=Object.keys(e.sorts);for(const n of t)we(e,n);e.isSorted=!0}function Te(e,t,n){return t[1].localeCompare(n[1],e)}function Ie(e,t){return e[1]-t[1]}function ve(e,t){return t[1]?-1:1}function we(e,t){const n=e.sorts[t];let o;switch(n.type){case"string":o=Te.bind(null,e.language);break;case"number":o=Ie.bind(null);break;case"boolean":o=ve.bind(null)}n.orderedDocs.sort(o);const r=n.orderedDocs.length;for(let e=0;e<r;e++){const t=n.orderedDocs[e][0];n.docs.set(t,e)}}function De(e,t){const n=e.sorts[t];n.orderedDocsToRemove.size&&(n.orderedDocs=n.orderedDocs.filter((e=>!n.orderedDocsToRemove.has(e[0]))),n.orderedDocsToRemove.clear())}async function Se(e,t,n){if(!e.enabled)return;const o=e.sorts[t],r=(0,s.HM)(e.sharedInternalDocumentStore,n);o.docs.get(r)&&(o.docs.delete(r),o.orderedDocsToRemove.set(r,!0))}async function ke(e,t,n){if(!e.enabled)throw(0,g.T)("SORT_DISABLED");const o=n.property,r="DESC"===n.order,i=e.sorts[o];if(!i)throw(0,g.T)("UNABLE_TO_SORT_ON_UNKNOWN_FIELD",o,e.sortableProperties.join(", "));return De(e,o),be(e),t.sort(((t,n)=>{const o=i.docs.get((0,s.HM)(e.sharedInternalDocumentStore,t[0])),c=i.docs.get((0,s.HM)(e.sharedInternalDocumentStore,n[0])),a=void 0!==o,l=void 0!==c;return a||l?a?l?r?c-o:o-c:-1:1:0})),t}async function Pe(e){return e.enabled?e.sortableProperties:[]}async function Me(e){return e.enabled?e.sortablePropertiesWithTypes:{}}async function Oe(e,t){const n=t;if(!n.enabled)return{enabled:!1};const o=Object.keys(n.sorts).reduce(((e,t)=>{const{docs:o,orderedDocs:r,type:s}=n.sorts[t];return e[t]={docs:new Map(Object.entries(o).map((([e,t])=>[+e,t]))),orderedDocsToRemove:new Map,orderedDocs:r,type:s},e}),{});return{sharedInternalDocumentStore:e,language:n.language,sortableProperties:n.sortableProperties,sortablePropertiesWithTypes:n.sortablePropertiesWithTypes,sorts:o,enabled:!0,isSorted:n.isSorted}}async function xe(e){if(!e.enabled)return{enabled:!1};!function(e){const t=Object.keys(e.sorts);for(const n of t)De(e,n)}(e),be(e);const t=Object.keys(e.sorts).reduce(((t,n)=>{const{docs:o,orderedDocs:r,type:s}=e.sorts[n];return t[n]={docs:Object.fromEntries(o.entries()),orderedDocs:r,type:s},t}),{});return{language:e.language,sortableProperties:e.sortableProperties,sortablePropertiesWithTypes:e.sortablePropertiesWithTypes,sorts:t,enabled:e.enabled,isSorted:e.isSorted}}const Ae=192,Re=383,Ee=[65,65,65,65,65,65,65,67,69,69,69,69,73,73,73,73,69,78,79,79,79,79,79,null,79,85,85,85,85,89,80,115,97,97,97,97,97,97,97,99,101,101,101,101,105,105,105,105,101,110,111,111,111,111,111,null,111,117,117,117,117,121,112,121,65,97,65,97,65,97,67,99,67,99,67,99,67,99,68,100,68,100,69,101,69,101,69,101,69,101,69,101,71,103,71,103,71,103,71,103,72,104,72,104,73,105,73,105,73,105,73,105,73,105,73,105,74,106,75,107,107,76,108,76,108,76,108,76,108,76,108,78,110,78,110,78,110,110,78,110,79,111,79,111,79,111,79,111,82,114,82,114,82,114,83,115,83,115,83,115,83,115,84,116,84,116,84,116,85,117,85,117,85,117,85,117,85,117,85,117,87,119,89,121,89,90,122,90,122,90,122,115];var _e=n(2084);const Le={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},Ne={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},ze="[aeiouy]",Ce="[^aeiou][^aeiouy]*",Ue=ze+"[aeiou]*",We="^("+Ce+")?"+Ue+Ce,$e="^("+Ce+")?"+Ue+Ce+"("+Ue+")?$",je="^("+Ce+")?"+Ue+Ce+Ue+Ce,Fe="^("+Ce+")?"+ze;function Be(e){let t,n,o,r,s,i;if(e.length<3)return e;const c=e.substring(0,1);if("y"==c&&(e=c.toUpperCase()+e.substring(1)),o=/^(.+?)(ss|i)es$/,r=/^(.+?)([^s])s$/,o.test(e)?e=e.replace(o,"$1$2"):r.test(e)&&(e=e.replace(r,"$1$2")),o=/^(.+?)eed$/,r=/^(.+?)(ed|ing)$/,o.test(e)){const t=o.exec(e);o=new RegExp(We),o.test(t[1])&&(o=/.$/,e=e.replace(o,""))}else r.test(e)&&(t=r.exec(e)[1],r=new RegExp(Fe),r.test(t)&&(e=t,r=/(at|bl|iz)$/,s=new RegExp("([^aeiouylsz])\\1$"),i=new RegExp("^"+Ce+ze+"[^aeiouwxy]$"),r.test(e)?e+="e":s.test(e)?(o=/.$/,e=e.replace(o,"")):i.test(e)&&(e+="e")));if(o=/^(.+?)y$/,o.test(e)){const n=o.exec(e);t=null==n?void 0:n[1],o=new RegExp(Fe),t&&o.test(t)&&(e=t+"i")}if(o=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,o.test(e)){const r=o.exec(e);t=null==r?void 0:r[1],n=null==r?void 0:r[2],o=new RegExp(We),t&&o.test(t)&&(e=t+Le[n])}if(o=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,o.test(e)){const r=o.exec(e);t=null==r?void 0:r[1],n=null==r?void 0:r[2],o=new RegExp(We),t&&o.test(t)&&(e=t+Ne[n])}if(o=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,r=/^(.+?)(s|t)(ion)$/,o.test(e)){const n=o.exec(e);t=null==n?void 0:n[1],o=new RegExp(je),t&&o.test(t)&&(e=t)}else if(r.test(e)){const n=r.exec(e);t=(null==n?void 0:n[1])??""+(null==n?void 0:n[2])??"",r=new RegExp(je),r.test(t)&&(e=t)}if(o=/^(.+?)e$/,o.test(e)){const n=o.exec(e);t=null==n?void 0:n[1],o=new RegExp(je),r=new RegExp($e),s=new RegExp("^"+Ce+ze+"[^aeiouwxy]$"),t&&(o.test(t)||r.test(t)&&!s.test(t))&&(e=t)}return o=/ll$/,r=new RegExp(je),o.test(e)&&r.test(e)&&(o=/.$/,e=e.replace(o,"")),"y"==c&&(e=c.toLowerCase()+e.substring(1)),e}function Ve(e,t){var n;const o=`${this.language}:${e}:${t}`;return this.normalizationCache.has(o)?this.normalizationCache.get(o):(null===(n=this.stopWords)||void 0===n?void 0:n.includes(t))?(this.normalizationCache.set(o,""),""):(this.stemmer&&!this.stemmerSkipProperties.has(e)&&(t=this.stemmer(t)),t=function(e){const t=[];for(let o=0;o<e.length;o++)t[o]=(n=e.charCodeAt(o))<Ae||n>Re?n:Ee[n-Ae]||n;var n;return String.fromCharCode(...t)}(t),this.normalizationCache.set(o,t),t)}function He(e,t,n){if(t&&t!==this.language)throw(0,g.T)("LANGUAGE_NOT_SUPPORTED",t);if("string"!=typeof e)return[e];let o;if(n&&this.tokenizeSkipProperties.has(n))o=[this.normalizeToken.bind(this,n??"")(e)];else{const t=_e.zr[this.language];o=e.toLowerCase().split(t).map(this.normalizeToken.bind(this,n??"")).filter(Boolean)}const r=function(e){for(;""===e[e.length-1];)e.pop();for(;""===e[0];)e.shift();return e}(o);return this.allowDuplicates?r:Array.from(new Set(r))}async function qe(e={}){if(e.language){if(!_e.E7.includes(e.language))throw(0,g.T)("LANGUAGE_NOT_SUPPORTED",e.language)}else e.language="english";let t,n;if(e.stemming||e.stemmer&&!("stemming"in e))if(e.stemmer){if("function"!=typeof e.stemmer)throw(0,g.T)("INVALID_STEMMER_FUNCTION_TYPE");t=e.stemmer}else{if("english"!==e.language)throw(0,g.T)("MISSING_STEMMER",e.language);t=Be}if(!1!==e.stopWords){if(n=[],Array.isArray(e.stopWords))n=e.stopWords;else if("function"==typeof e.stopWords)n=await e.stopWords(n);else if(e.stopWords)throw(0,g.T)("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");if(!Array.isArray(n))throw(0,g.T)("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");for(const e of n)if("string"!=typeof e)throw(0,g.T)("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY")}const o={tokenize:He,language:e.language,stemmer:t,stemmerSkipProperties:new Set(e.stemmerSkipProperties?[e.stemmerSkipProperties].flat():[]),tokenizeSkipProperties:new Set(e.tokenizeSkipProperties?[e.tokenizeSkipProperties].flat():[]),stopWords:n,allowDuplicates:Boolean(e.allowDuplicates),normalizeToken:Ve,normalizationCache:new Map};return o.tokenize=He.bind(o),o.normalizeToken=Ve,o}async function Ge({schema:e,sort:t,language:n,components:T,id:I,plugins:v}){T||(T={}),I||(I=await(0,r.EL)());let w=T.tokenizer,D=T.index,S=T.documentsStore,k=T.sorter;if(w?w.tokenize||(w=await qe(w)):w=await qe({language:n??"english"}),T.tokenizer&&n)throw(0,g.T)("NO_LANGUAGE_WITH_CUSTOM_TOKENIZER");const P=(0,s.Lo)();D||=await async function(){return{create:te,insert:oe,remove:se,insertDocumentScoreParameters:X,insertTokenScoreParameters:Z,removeDocumentScoreParameters:J,removeTokenScoreParameters:Q,calculateResultScores:ee,search:ie,searchByWhereClause:ce,getSearchableProperties:ae,getSearchablePropertiesWithTypes:le,load:he,save:pe}}(),k||=await async function(){return{create:me,insert:ye,remove:Se,save:xe,load:Oe,sortBy:ke,getSortableProperties:Pe,getSortablePropertiesWithTypes:Me}}(),S||=await async function(){return{create:i,get:c,getMultiple:a,getAll:l,store:u,remove:f,count:d,load:h,save:p}}(),function(e){const t={formatElapsedTime:o.formatElapsedTime,getDocumentIndexId:o.getDocumentIndexId,getDocumentProperties:r.OX,validateSchema:o.validateSchema};for(const n of b.RI){const o=n;if(e[o]){if("function"!=typeof e[o])throw(0,g.T)("COMPONENT_MUST_BE_FUNCTION",o)}else e[o]=t[o]}for(const t of Object.keys(e))if(!b.me.includes(t)&&!b.RI.includes(t))throw(0,g.T)("UNSUPPORTED_COMPONENT",t)}(T);const{getDocumentProperties:M,getDocumentIndexId:O,validateSchema:x,formatElapsedTime:A}=T,R={data:{},caches:{},schema:e,tokenizer:w,index:D,sorter:k,documentsStore:S,internalDocumentIDStore:P,getDocumentProperties:M,getDocumentIndexId:O,validateSchema:x,beforeInsert:[],afterInsert:[],beforeRemove:[],afterRemove:[],beforeUpdate:[],afterUpdate:[],beforeSearch:[],afterSearch:[],beforeInsertMultiple:[],afterInsertMultiple:[],beforeRemoveMultiple:[],afterRemoveMultiple:[],afterUpdateMultiple:[],beforeUpdateMultiple:[],formatElapsedTime:A,id:I,plugins:v};R.data={index:await R.index.create(R,P,e),docs:await R.documentsStore.create(R,P),sorting:await R.sorter.create(R,P,e,t)};for(const e of m)R[e]=(R[e]??[]).concat(await y(R,e));return R}}};
//# sourceMappingURL=569.index.js.map